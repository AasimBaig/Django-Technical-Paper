# Django Technical Paper

## Secret Keys

---

Secret keys is a long string which has alphabets, numbers and special character.
<br />

When we create a new Django project using `django startproject projectname` the `SECRET KEY` is automatically generated by Django.
<br />

Secret key is used for anything that uses cryptographic signing to verify that some data came from your server. Only someone who has the secret key should be able to create a valid signature, in most cases that's your server.

What is Secret Key used for?

- Cookie-based sessions uses cryptographic signing.
- PasswordResetView Tokens (Resetting Password).

Best Practises for Secret Key

- Keep it out of source control.
- Have a different secret key for all of your stages.
- Save it in an environment variable.

## Default Django Apps

---

Difference b/w project and app? <br/>

A project refers to the entire application and all its parts.

An app refers to a submodule of the project. It's self-sufficient and not intertwined with the other apps in the project such that, in theory, you could pick it up and plop it down into another project without any modification.

Django comes with 6 default apps:

1. django.contrib.admin - The automatic django administrative interface.
2. django.contrib.auth - Django authentication framework
3. django.contrib.contenttypes - Light framework for hooking into "types" of content where each installed Django model is a separate content type.
4. django.contrib.sessions - A framework for storing data in anonymous sessions.
5. django.contrib.messages - A framework for storing and retrieving temporary cookie- or session-based messages
6. django.contrib.staticfiles - Collects static files from each of your applications (and any other places you specify) into a single location that can easily be served in production.

Extra Django apps that are avaliable to use.

1. flatpages - A framework for managing “flat” HTML content in a database.
2. gis - A world-class geospatial framework built on top of Django, that enables storage, manipulation and display of spatial data.
3. humanize - A set of Django template filters useful for adding a “human touch” to data.
4. messages - A framework for storing and retrieving temporary cookie- or session-based messages
5. postgres - A collection of PostgreSQL specific features.
6. redirects - A framework for managing redirects.
7. sites - A light framework that lets you operate multiple websites off of the same database and Django installation. It gives you hooks for associating objects to one or more sites.
8. sitemaps - A framework for generating Google sitemap XML files.
9. syndication - A framework for generating syndication feeds, in RSS and Atom, quite easily.

- We can also add our own created application and use their functions.
- Application names and labels must be unique in INSTALLED_APPS.
- Application names - The dotted python path to the application package must be unique. There is no way to include the same application twice, short of duplicating its code under another name.
- Application label - By default the final part of the name must be unique too. For example, you can't include both django.contrib.auth and myproject.auth

## Middle Ware

---

> Middleware is a framework of hooks into Django’s request/response processing. It’s a light, low-level “plugin” system for globally altering Django’s input or output.

<a href="https://ibb.co/vc59fmm"><img src="https://i.ibb.co/51DZCvv/django-1.png" alt="django-1" border="0"></a>

_Django Architecture_

<a href="https://ibb.co/jgQFkzn"><img src="https://i.ibb.co/QrTGvky/django2.png" alt="django2" border="0"></a>

_Django Middleware_

- `django.middleware.security.SecurityMiddleware` - provides several security enhancements to the request/response cycle. Each one can be independently enabled or disabled with a setting.

SECURE_BROWSER_XSS_FILTER - Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. XSS attacks occur when an attacker uses a web application to send malicious code, generally in the form of a browser side script, to a different end user.
Example- `http://bobssite.org/search?q=<script>alert('xss');</script>`

- `django.contrib.sessions.middleware.SessionMiddleware` - Enables session support.
- `django.middleware.common.CommonMiddleware` - Forbids access to user agents in the DISALLOWED_USER_AGENTS setting, which should be a list of compiled regular expression objects. <br/>
  Performs URL rewriting based on the APPEND_SLASH and PREPEND_WWW settings.
- `django.middleware.csrf.CsrfViewMiddleware` - The CSRF middleware and template tag provides easy-to-use protection against Cross Site Request Forgeries. This type of attack occurs when a malicious website contains a link, a form button or some JavaScript that is intended to perform some action on your website, using the credentials of a logged-in user who visits the malicious site in their browser.
- `django.contrib.auth.middleware.AuthenticationMiddleware` - Django uses sessions and middleware to hook the authentication system into request objects.
  These provide a request.user attribute on every request which represents the current user. If the current user has not logged in, this attribute will be set to an instance of AnonymousUser, otherwise it will be an instance of User.

- `django.contrib.messages.middleware.MessageMiddleware` - Quite commonly in web applications, you need to display a one-time notification message (also known as “flash message”) to the user after processing a form or some other types of user input. For this, Django provides full support for cookie- and session-based messaging, for both anonymous and authenticated users. The messages framework allows you to temporarily store messages in one request and retrieve them for display in a subsequent request (usually the next one).

- `django.middleware.clickjacking.XFrameOptionsMiddleware` - Quite commonly in web applications, you need to display a one-time notification message (also known as “flash message”) to the user after processing a form or some other types of user input. For this, Django provides full support for cookie- and session-based messaging, for both anonymous and authenticated users. The messages framework allows you to temporarily store messages in one request and retrieve them for display in a subsequent request (usually the next one).

Example of CSRF -

Cross-Site Request Forgery (CSRF) in simple words

- Assume you are currently logged into your online banking at www.mybank.com
- Assume a money transfer from mybank.com will result in a request of (conceptually) the form http://www.mybank.com/transfer?to=<SomeAccountnumber>;amount=<SomeAmount>. (Your account number is not needed, because it is implied by your login.)
- You visit www.cute-cat-pictures.org, not knowing that it is a malicious site.
- If the owner of that site knows the form of the above request (easy!) and correctly guesses you are logged into mybank.com (requires some luck!), they could include on their page a request like http://www.mybank.com/transfer?to=123456;amount=10000 (where 123456 is the number of their Cayman Islands account and 10000 is an amount that you previously thought you were glad to possess).
- You retrieved that www.cute-cat-pictures.org page, so your browser will make that request.
- Your bank cannot recognize this origin of the request: Your web browser will send the request along with your www.mybank.com cookie and it will look perfectly legitimate. There goes your money!

This is the world without CSRF tokens.

Now for the better one with CSRF tokens:

- The transfer request is extended with a third argument: http://www.mybank.com/transfer?to=123456;amount=10000;token=31415926535897932384626433832795028841971.
- That token is a huge, impossible-to-guess random number that mybank.com will include on their own web page when they serve it to you. It is different each time they serve any page to anybody.
- The attacker is not able to guess the token, is not able to convince your web browser to surrender it (if the browser works correctly...), and so the attacker will not be able to create a valid request, because requests with the wrong token (or no token) will be refused by www.mybank.com.

Example of Clickjacking

Suppose an online store has a page where a logged in user can click “Buy Now” to purchase an item. A user has chosen to stay logged into the store all the time for convenience. An attacker site might create an “I Like Ponies” button on one of their own pages, and load the store’s page in a transparent iframe such that the “Buy Now” button is invisibly overlaid on the “I Like Ponies” button. If the user visits the attacker’s site, clicking “I Like Ponies” will cause an inadvertent click on the “Buy Now” button and an unknowing purchase of the item.

## References

---

[Django Secret Key Security](https://security.stackexchange.com/questions/61909/django-secret-key-security-how-are-methods-more-secure)

[Effects of Changing Django Key](https://stackoverflow.com/questions/15170637/effects-of-changing-djangos-secret-key/15383766#15383766)

[Cryptographic Signing](https://docs.djangoproject.com/en/2.2/topics/signing/)

[Default App in Django](https://docs.djangoproject.com/en/2.2/ref/contrib/)

---

Created by Mirza AasimBaig
